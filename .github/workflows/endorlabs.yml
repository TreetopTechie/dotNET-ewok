name: Scan

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  scan:
    permissions:
      security-events: write
      contents: read
      id-token: write
      pull-requests: write
      issues: write
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3
#    - name: Setup dotnet
#      uses: actions/setup-dotnet@v3
#      with:
#       dotnet-version: |
#         7.0.x
#    - name: Restore .NET
#      run: dotnet restore --use-lock-file
    
    - name: Run endorctl
      uses: endorlabs/github-action@v1.1.2
      with:
        namespace: "matt-demo-2"
        api: "https://api.endorlabs.com"
        enable_github_action_token: "true"
        pr: false
        enable_pr_comments: true
        github_token: ${{ secrets.GITHUB_TOKEN }}
        sarif_file: endor-labs.sarif
        tags: "actor=${{ github.actor }},run-id=${{ github.run_id }}"


    - name: Upload SARIF to github
      uses: github/codeql-action/upload-sarif@v3
      with:
        sarif_file: endor-labs.sarif
